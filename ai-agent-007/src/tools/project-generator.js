/**
 * Project Generator Tool
 * 
 * Generates project scaffolding and boilerplate
 */

import { writeFile } from '../utils/file-system.js';
import { join } from 'path';

export class ProjectGenerator {
  constructor(config = {}) {
    this.config = config;
  }

  /**
   * Generate a new project structure
   */
  async generateProject(spec) {
    const { type, name, outputDir } = spec;

    switch (type) {
      case 'webapp':
        return this.generateWebApp(name, outputDir);
      case 'api':
        return this.generateAPI(name, outputDir);
      case 'cli':
        return this.generateCLI(name, outputDir);
      default:
        throw new Error(`Unknown project type: ${type}`);
    }
  }

  /**
   * Generate a web application
   */
  async generateWebApp(name, outputDir) {
    const files = {
      'package.json': this.createPackageJson(name, 'webapp'),
      'index.html': this.createIndexHtml(name),
      'src/App.jsx': this.createAppComponent(),
      'src/index.jsx': this.createIndexFile(),
      'README.md': this.createReadme(name, 'Web Application'),
    };

    for (const [path, content] of Object.entries(files)) {
      await writeFile(join(outputDir, path), content);
    }

    return { success: true, files: Object.keys(files) };
  }

  /**
   * Generate an API server
   */
  async generateAPI(name, outputDir) {
    // TODO: Implement API generation
    return { success: true, files: [] };
  }

  /**
   * Generate a CLI tool
   */
  async generateCLI(name, outputDir) {
    // TODO: Implement CLI generation
    return { success: true, files: [] };
  }

  // Template generators
  createPackageJson(name, type) {
    return JSON.stringify({
      name,
      version: '1.0.0',
      type: 'module',
      description: `Generated ${type} by AI Agent 007`,
      scripts: {
        dev: 'vite',
        build: 'vite build',
      },
    }, null, 2);
  }

  createIndexHtml(name) {
    return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${name}</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/index.jsx"></script>
</body>
</html>`;
  }

  createAppComponent() {
    return `export default function App() {
  return (
    <div>
      <h1>Welcome to your AI-generated app!</h1>
    </div>
  );
}`;
  }

  createIndexFile() {
    return `import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);`;
  }

  createReadme(name, type) {
    return `# ${name}

${type} generated by AI Agent 007

## Getting Started

\`\`\`bash
npm install
npm run dev
\`\`\`
`;
  }
}
